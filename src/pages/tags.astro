---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const allTags = posts.flatMap((post) => post.data.tags);
const tagCounts = allTags.reduce((acc, tag) => {
  acc[tag] = (acc[tag] || 0) + 1;
  return acc;
}, {} as Record<string, number>);

const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="tags">
  <div class="mb-10">
    <div class="flex items-center gap-3 mb-3">
      <span class="text-accent-green text-xl">$</span>
      <h1 class="text-2xl font-bold text-text-primary">git tag</h1>
    </div>
    <p class="text-text-secondary text-lg">Browse commits by tag</p>
  </div>

  <div class="flex flex-wrap gap-3">
    {sortedTags.map(([tag, count]) => (
      <a
        href={`/tags/${tag}`}
        class="px-4 py-2.5 rounded-lg border bg-bg-secondary border-border text-text-secondary hover:border-accent-yellow hover:text-text-primary transition-all"
      >
        <span class="font-mono">{tag}</span>
        <span class="ml-2 text-sm opacity-70">({count})</span>
      </a>
    ))}
  </div>
</BaseLayout>
