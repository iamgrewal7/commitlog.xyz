---
import BaseLayout from '../../layouts/BaseLayout.astro';
import CommitCard from '../../components/blog/CommitCard.astro';
import BranchNav from '../../components/blog/BranchNav.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const branches = [...new Set(posts.map((post) => post.data.branch))];
---

<BaseLayout title="blog" description="All commits (blog posts)">
  <div class="mb-10">
    <div class="flex items-center gap-3 mb-3">
      <span class="text-accent-green text-xl">$</span>
      <h1 class="text-xl sm:text-2xl font-bold text-text-primary">git log</h1>
    </div>
    <p class="text-text-secondary">Showing all commits</p>
  </div>

  <BranchNav branches={branches} />

  <div class="space-y-4 sm:space-y-6">
    {posts.map((post) => (
      <CommitCard post={post} />
    ))}
  </div>

  {posts.length === 0 && (
    <div class="text-center py-16 text-text-muted">
      <p>No commits found.</p>
    </div>
  )}
</BaseLayout>
